<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Conversación - In Houston Texas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#F7BD02" />
  <style>
    :root{
      --brand:#F7BD02;      /* amarillo marca (fondo) */
      --ink:#000000;        /* negro */
      --paper:#ffffff;      /* blanco (burbujas usuario y botón volver) */
      --botText:#F7BD02;    /* texto de burbuja bot */
      --radius:18px;
    }

    *{ box-sizing: border-box; }
    html, body{
      margin:0; padding:0; height:100%;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== Lienzo principal con fondo amarillo ===== */
    .app{
      min-height:100vh;
      display:flex; flex-direction:column;
      background: var(--brand);
    }

    /* ===== Barra superior negra con nombre en amarillo ===== */
    .brandbar{
      background: var(--ink);
      color: var(--brand);
      padding: calc(env(safe-area-inset-top) + 10px) 14px 12px 14px;
      font-weight: 900;
      letter-spacing: .2px;
      text-align:center;
      position:sticky; top:0; z-index:20;
    }
    .brandbar .company{
      max-width: 100%;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    /* ===== Franja tipo WhatsApp con Volver + identificador ===== */
    .toolbar{
      display:flex; align-items:center; justify-content:space-between; gap:15px;
      padding: 10px 12px;
      position:sticky; top: calc(env(safe-area-inset-top) + 48px); z-index:15;
      /* la franja vive sobre el fondo amarillo */
    }
    .back{
      display:inline-flex; align-items:center; gap:8px;
      background: var(--paper);
      color: var(--ink);
      border: 2px solid var(--ink);
      border-radius: 12px;
      padding: 10px 14px;
      text-decoration:none;
      font-weight: 800;
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
      transition: transform .06s ease, box-shadow .2s ease;
    }
    .back:active{ transform:translateY(1px); box-shadow:0 4px 12px rgba(0,0,0,.12); }

    .idpill{
      background: var(--ink);
      color: var(--brand);
      border: 2px solid var(--ink);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 800;
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
      text-decoration:none;
    }
    .idpill a{ color: var(--brand); text-decoration: underline; }

    /* ===== Área de chat ===== */
    .chat{
      flex:1;
      padding: 10px 12px 14px 12px;
      overflow-y:auto;
    }
    .group{ display:flex; flex-direction:column; gap:10px; }

    .bubble{
      max-width: 86%;
      padding: 14px 16px;
      border-radius: var(--radius);
      line-height: 1.45;
      word-wrap: break-word;
      box-shadow: 0 10px 22px rgba(0,0,0,.15);
      position: relative;
      font-size: 16px;
    }

    /* Usuario = burbuja blanca, a la izquierda */
    .user{
      align-self: flex-start;
      background: var(--paper);
      color: var(--ink);
      border-top-left-radius: 8px;
    }
    .user::after{
      content:""; position:absolute; left:12px; bottom:-8px;
      width:14px; height:14px; background: var(--paper); transform: rotate(45deg);
      box-shadow: 2px 2px 4px rgba(0,0,0,.08);
    }

    /* Bot = burbuja negra con texto amarillo, a la derecha */
    .bot{
      align-self: flex-end;
      background: var(--ink);
      color: var(--botText);
      border-top-right-radius: 8px;
      text-align: left;
    }
    .bot::after{
      content:""; position:absolute; right:12px; bottom:-8px;
      width:14px; height:14px; background: var(--ink); transform: rotate(45deg);
      box-shadow: 2px 2px 4px rgba(0,0,0,.25);
    }

    .time{
      display:block;
      margin-top:6px;
      font-size:12px;
      opacity:.8;
    }

    .foot{
      padding: 8px 12px calc(env(safe-area-inset-bottom) + 8px);
      text-align:center; font-size:12px; color:#3a3000;
      font-weight:600;
    }

    /* Responsive */
    @media (max-width:480px){
      .bubble{ font-size: 15.5px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Barra superior negra con nombre de la compañía en amarillo -->
    <div class="brandbar">
      <div class="company">{{ bot if bot else 'Panel de Conversaciones' }}</div>
    </div>

    <!-- Franja tipo WhatsApp: botón Volver (blanco/negro) + identificador del contacto -->
    <div class="toolbar">
      <a class="back" href="{{ url_for('panel') }}" aria-label="Volver al panel">⬅ Volver</a>
      <div class="idpill">
        whatsapp: <a href="https://wa.me/{{ numero | replace('+','') }}" target="_blank" rel="noopener">+{{ numero | replace('+','') }}</a>
      </div>
    </div>

    <!-- Mensajes -->
    <main id="chat" class="chat">
      <div class="group">
        {% for msg in mensajes %}
          <div class="bubble {{ msg.tipo }}">
            <div>{{ msg.texto }}</div>
            <small class="time">{{ msg.hora }}</small>
          </div>
        {% endfor %}
      </div>
    </main>

    <div class="foot">In Houston Texas · Sistema de Leads © 2025</div>
  </div>

  <script>
    // Autoscroll al último mensaje
    (function(){
      const el = document.getElementById('chat');
      if (!el) return;
      setTimeout(()=>{ el.scrollTop = el.scrollHeight; }, 50);
    })();
  </script>
</body>
</html>
