<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Acceso - Panel de Leads | In Houston Texas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <style>
    :root{ --brand:#F7BD02; --bg:#000; --card:#fff; --text:#000; --muted:#888; --radius:16px; --focus:#2b90ff; }
    *{ box-sizing: border-box; }
    html, body { margin:0; padding:0; height:100%; background:var(--bg); color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; font-size:17px; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .login-wrap{ min-height:100vh; display:grid; place-items:center; background:
      radial-gradient(1200px 600px at 100% 0%, rgba(247,189,2,0.15), transparent 60%),
      radial-gradient(1200px 600px at 0% 100%, rgba(247,189,2,0.12), transparent 60%),
      linear-gradient(135deg,#000 0%,#0a0a0a 100%); padding:env(safe-area-inset-top) 16px env(safe-area-inset-bottom); }
    .card{ width:100%; max-width:420px; background:var(--card); color:var(--text); border-radius:var(--radius); box-shadow:0 18px 44px rgba(0,0,0,.35); padding:28px; }
    .brand{ display:flex; align-items:center; gap:12px; margin-bottom:10px; justify-content:center; }
    .brand img{ width:42px; height:42px; border-radius:12px; object-fit:cover; }
    .brand-name{ font-weight:800; letter-spacing:.2px; }
    h1{ margin:8px 0 18px; font-size:24px; text-align:center; color:var(--brand); }
    .subtitle{ text-align:center; color:#333; font-size:15px; margin-bottom:18px; }
    .alert{ background:#ffe5e5; color:#9b1c1c; border:1px solid #f6caca; padding:12px 14px; border-radius:12px; font-size:15px; margin-bottom:14px; text-align:center; }
    .form{ display:grid; gap:14px; }
    .field{ display:grid; gap:8px; }
    label{ font-size:15px; color:#222; font-weight:600; }
    input[type="text"], input[type="password"]{ width:100%; padding:16px 14px; border:1px solid #ddd; border-radius:12px; background:#f7f7f7; font-size:18px; line-height:1.15; outline:none; transition:border-color .2s, box-shadow .2s, background .2s; }
    input::placeholder{ color:#999; }
    input:focus{ border-color:var(--focus); background:#fff; box-shadow:0 0 0 3px rgba(43,144,255,.15); }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:2px; }
    .remember{ display:inline-flex; align-items:center; gap:10px; color:#333; font-size:15px; }
    .remember input[type="checkbox"]{ width:20px; height:20px; accent-color:var(--brand); }
    .action{ margin-top:8px; }
    button[type="submit"]{ width:100%; border:0; border-radius:12px; background:var(--brand); color:#000; padding:16px; font-weight:800; font-size:18px; letter-spacing:.2px; cursor:pointer; transition:transform .06s ease, box-shadow .2s ease, background .2s ease; box-shadow:0 8px 22px rgba(247,189,2,.35); touch-action:manipulation; }
    button[type="submit"]:active{ transform:translateY(1px); box-shadow:0 6px 16px rgba(247,189,2,.35); }
    button[type="submit"]:hover{ background:#000; color:var(--brand); box-shadow:0 10px 26px rgba(0,0,0,.25); }
    .footer{ margin-top:16px; font-size:13px; color:var(--muted); text-align:center; }
    @media (max-width:480px){ .card{ padding:24px; } h1{ font-size:22px; } }
  </style>
</head>
<body>
  <div class="login-wrap">
    <div class="card" role="dialog" aria-labelledby="title" aria-describedby="subtitle">
      <div class="brand">
        <img src="/static/logo_in.png" alt="Logo In Houston Texas" onerror="this.style.display='none'">
        <div class="brand-name">IN HOUSTON TEXAS</div>
      </div>

      <h1 id="title">Acceso al Panel</h1>
      <div id="subtitle" class="subtitle">Ingresa tu usuario y contraseña para continuar</div>

      {% if error %}
        <div class="alert">Usuario o contraseña incorrectos. Inténtalo de nuevo.</div>
      {% endif %}

      <!-- Importante: Safari espera name="username" (visible) y name="password" -->
      <form class="form" method="POST" action="/panel" autocomplete="on">
        <div class="field">
          <label for="usuario">Usuario</label>
          <!-- CAMBIO CLAVE: este input visible ahora se llama username -->
          <input id="usuario" type="text" name="username"
                 placeholder="Escribe tu usuario" required inputmode="text"
                 autocapitalize="none" autocorrect="off" spellcheck="false"
                 autocomplete="username" />
          <!-- Compat con tu backend: le seguimos mandando 'usuario' en oculto -->
          <input type="hidden" id="usuarioHidden" name="usuario" />
        </div>

        <div class="field">
          <label for="clave">Contraseña</label>
          <input id="clave" type="password" name="password"
                 placeholder="Escribe tu contraseña" required
                 autocomplete="current-password" />
        </div>

        <div class="row">
          <label class="remember">
            <input type="checkbox" name="remember" id="remember" />
            Recuérdame
          </label>

          <button type="button" id="togglePwd" aria-controls="clave" aria-label="Mostrar u ocultar contraseña"
                  style="background:#efefef;padding:10px 12px;border-radius:10px;border:1px solid #ddd;font-weight:600;cursor:pointer;">
            Ver
          </button>
        </div>

        <input type="hidden" name="recordarme" id="recordarmeHidden" />

        <div class="action">
          <button type="submit" id="submitBtn">Entrar</button>
        </div>
      </form>

      <div class="footer">In Houston Texas - Sistema de Leads © 2025</div>
    </div>
  </div>

  <script>
    // Cookies simples para recordar último usuario (opcional)
    function setCookie(name, value, days){
      try{
        const max = days ? ';max-age='+(days*24*60*60) : '';
        document.cookie = name + '=' + encodeURIComponent(value) + ';path=/' + max + ';SameSite=Lax';
      }catch(e){}
    }
    function getCookie(name){
      try{
        const m = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return m ? decodeURIComponent(m[2]) : '';
      }catch(e){ return ''; }
    }

    (function(){
      const form = document.querySelector('form');
      const submit = document.getElementById('submitBtn');
      const toggle = document.getElementById('togglePwd');
      const pwd = document.getElementById('clave');
      const user = document.getElementById('usuario');           // visible (name="username")
      const usuarioHidden = document.getElementById('usuarioHidden'); // para backend
      const rememberChk = document.getElementById('remember');
      const recordarmeHidden = document.getElementById('recordarmeHidden');

      // Evitar doble envío
      form.addEventListener('submit', function(){
        submit.disabled = true;
        submit.textContent = 'Ingresando…';
        setTimeout(()=>{ submit.disabled = false; submit.textContent = 'Entrar'; }, 6000);
      });

      // Mostrar/ocultar contraseña
      toggle.addEventListener('click', function(){
        const visible = pwd.type === 'text';
        pwd.type = visible ? 'password' : 'text';
        toggle.textContent = visible ? 'Ver' : 'Ocultar';
      });

      // Sincroniza el oculto 'usuario' con el visible 'username'
      function syncUsuario(){
        if (usuarioHidden) usuarioHidden.value = user ? (user.value || '') : '';
      }
      user.addEventListener('input', syncUsuario);
      user.addEventListener('change', syncUsuario);

      // Foco y precarga
      if (user) setTimeout(()=>user.focus(), 200);
      try{
        const lastUser = getCookie('last_username');
        if (lastUser && user && !user.value){ user.value = lastUser; syncUsuario(); }
      }catch(e){}

      // LocalStorage “Recuérdame”
      try{
        const savedRemember = localStorage.getItem('login_remember') === '1';
        const savedUser = localStorage.getItem('login_user') || '';
        const savedPass = localStorage.getItem('login_pass') || '';
        if (savedRemember) {
          if (user && !user.value){ user.value = savedUser; syncUsuario(); }
          if (pwd && !pwd.value) pwd.value = savedPass;
          if (rememberChk) rememberChk.checked = true;
          if (recordarmeHidden) recordarmeHidden.value = 'on';
        }
      }catch(e){}

      // Antes de enviar: flags y guardado local
      form.addEventListener('submit', function(){
        if (recordarmeHidden) recordarmeHidden.value = (rememberChk && rememberChk.checked) ? 'on' : '';
        syncUsuario();
        try{
          if (user && user.value) setCookie('last_username', user.value, 365);
          if (rememberChk && rememberChk.checked){
            localStorage.setItem('login_remember', '1');
            localStorage.setItem('login_user', user ? user.value : '');
            localStorage.setItem('login_pass', pwd ? pwd.value : '');
          }else{
            localStorage.removeItem('login_remember');
            localStorage.removeItem('login_user');
            localStorage.removeItem('login_pass');
          }
        }catch(e){}
      });

      rememberChk && rememberChk.addEventListener('change', function(){
        if (recordarmeHidden) recordarmeHidden.value = rememberChk.checked ? 'on' : '';
      });

      // Inicializa el oculto por si ya había valor.
      syncUsuario();
    })();
  </script>
</body>
</html>
